"""
Autogenerated return type of AcceptInvite.
"""
type AcceptInvitePayload {
  agent: Agent
  errors: [Error!]!
}

"""
Autogenerated return type of AddComment.
"""
type AddCommentPayload {
  comment: Comment
  errors: [Error!]!
}

"""
A support agent user
"""
type Agent {
  """
  Tickets actively being worked on (not new or closed)
  """
  activeTickets: [Ticket!]!
  createdAt: ISO8601DateTime!
  email: String!

  """
  Human-readable history events
  """
  history: [HistoryEvent!]!
  id: ID!

  """
  Whether the agent has a pending invitation
  """
  invitationPending: Boolean!
  invitedBy: Agent
  isAdmin: Boolean!
  name: String
  updatedAt: ISO8601DateTime!
}

"""
Statistics for a specific agent
"""
type AgentStats {
  agent: Agent!
  assignedTickets: Int!
  averageResolutionTimeHours: Float
  closedThisMonth: Int!
  closedThisWeek: Int!
  closedTickets: Int!
  openTickets: Int!
}

"""
Autogenerated return type of AssignTicket.
"""
type AssignTicketPayload {
  errors: [Error!]!
  ticket: Ticket
}

"""
A file attachment
"""
type Attachment {
  byteSize: Int!
  contentType: String!
  createdAt: ISO8601DateTime!
  filename: String!
  id: ID!
  url: String!
}

"""
An available state transition for a ticket
"""
type AvailableTransition {
  """
  The AASM event name to trigger
  """
  event: String!

  """
  Human-readable label for the transition
  """
  label: String!
}

"""
A comment on a ticket
"""
type Comment {
  """
  File attachments
  """
  attachments: [Attachment!]!
  author: CommentAuthorUnion!
  body: String!
  createdAt: ISO8601DateTime!
  id: ID!
  ticket: Ticket!
  updatedAt: ISO8601DateTime!
}

"""
The author of a comment (Customer or Agent)
"""
union CommentAuthorUnion = Agent | Customer

"""
Autogenerated return type of CreateDirectUpload.
"""
type CreateDirectUploadPayload {
  directUpload: DirectUpload
  errors: [Error!]!
}

"""
Autogenerated return type of CreateTicket.
"""
type CreateTicketPayload {
  errors: [Error!]!
  ticket: Ticket
}

"""
A customer user
"""
type Customer {
  createdAt: ISO8601DateTime!
  email: String!
  id: ID!
  name: String!
  tickets: [Ticket!]!
  updatedAt: ISO8601DateTime!
}

"""
Dashboard statistics for admin overview
"""
type DashboardStats {
  averageResolutionTimeHours: Float
  closedTickets: Int!
  openTickets: Int!
  ticketsByStatus: [StatusCount!]!
  ticketsClosedThisWeek: Int!
  ticketsClosedToday: Int!
  ticketsCreatedThisWeek: Int!
  ticketsCreatedToday: Int!
  totalTickets: Int!
  unassignedTickets: Int!
}

"""
Presigned URL for direct file upload
"""
type DirectUpload {
  """
  JSON headers to include in the upload request
  """
  headers: String!

  """
  The signed blob ID for attaching to records
  """
  signedId: String!

  """
  The URL to upload the file to
  """
  url: String!
}

"""
A user-facing error
"""
type Error {
  """
  Machine-readable error code
  """
  code: String!

  """
  Which field caused the error (null for base errors)
  """
  field: String

  """
  Human-readable error message
  """
  message: String!
}

"""
Autogenerated return type of ExportClosedTickets.
"""
type ExportClosedTicketsPayload {
  """
  True if export will be emailed
  """
  async: Boolean

  """
  CSV data (only for small exports)
  """
  csv: String
  errors: [Error!]!

  """
  Suggested filename for download
  """
  filename: String
}

"""
A human-readable history event
"""
type HistoryEvent {
  """
  Who performed the action
  """
  actor: CommentAuthorUnion

  """
  Human-readable description of what happened
  """
  event: String!
  id: ID!
  occurredAt: ISO8601DateTime!
}

"""
An ISO 8601-encoded datetime
"""
scalar ISO8601DateTime @specifiedBy(url: "https://tools.ietf.org/html/rfc3339")

"""
Autogenerated return type of InviteAgent.
"""
type InviteAgentPayload {
  agent: Agent
  errors: [Error!]!
}

type Mutation {
  """
  Accept an agent invitation
  """
  acceptInvite(invitationToken: String!, password: String!, passwordConfirmation: String!): AcceptInvitePayload

  """
  Add a comment to a ticket
  """
  addComment(
    """
    Signed blob IDs from direct upload
    """
    attachmentIds: [String!]
    body: String!
    ticketId: ID!
  ): AddCommentPayload

  """
  Manually assign a ticket to an agent (admin only)
  """
  assignTicket(agentId: ID!, ticketId: ID!): AssignTicketPayload

  """
  Create a presigned URL for direct file upload
  """
  createDirectUpload(
    """
    The size of the file in bytes
    """
    byteSize: Int!

    """
    Base64 MD5 checksum of the file
    """
    checksum: String!

    """
    The MIME type of the file
    """
    contentType: String!

    """
    The name of the file
    """
    filename: String!
  ): CreateDirectUploadPayload

  """
  Create a new support ticket (customers only)
  """
  createTicket(
    """
    Signed blob IDs from direct upload
    """
    attachmentIds: [String!]
    description: String!
    subject: String!
  ): CreateTicketPayload

  """
  Export closed tickets to CSV (agents only)
  """
  exportClosedTickets(
    """
    Filter tickets closed on or after this date
    """
    closedAfter: ISO8601DateTime

    """
    Filter closed on or before this date
    """
    closedBefore: ISO8601DateTime

    """
    Fields to include in export (defaults to standard set)
    """
    fields: [String!]
    filter: TicketFilterInput
  ): ExportClosedTicketsPayload

  """
  Invite a new agent (admin only)
  """
  inviteAgent(email: String!, isAdmin: Boolean = false, name: String!): InviteAgentPayload

  """
  Refresh access token using refresh token cookie
  """
  refreshToken(
    """
    Type of user: 'customer' or 'agent'
    """
    userType: String = "customer"
  ): RefreshTokenMutationPayload

  """
  Request a password reset email
  """
  requestPasswordReset(email: String!, userType: String = "customer"): RequestPasswordResetPayload

  """
  Reset password using token
  """
  resetPassword(password: String!, passwordConfirmation: String!, token: String!, userType: String = "customer"): ResetPasswordPayload

  """
  Sign in as customer or agent
  """
  signIn(
    email: String!
    password: String!

    """
    Type of user: 'customer' or 'agent'
    """
    userType: String = "customer"
  ): SignInPayload

  """
  Sign out and clear authentication cookies
  """
  signOut(
    """
    Type of user: 'customer' or 'agent'
    """
    userType: String = "customer"
  ): SignOutPayload

  """
  Register a new customer account
  """
  signUp(email: String!, name: String!, password: String!, passwordConfirmation: String!): SignUpPayload

  """
  Transition a ticket to a new status
  """
  transitionTicket(
    """
    AASM event name
    """
    event: String!
    ticketId: ID!
  ): TransitionTicketPayload
}

"""
Pagination information
"""
type PageInfo {
  currentPage: Int!
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  perPage: Int!
  totalCount: Int!
  totalPages: Int!
}

"""
Pagination parameters
"""
input PaginationInput {
  """
  Page number (1-indexed)
  """
  page: Int = 1

  """
  Items per page (max 100)
  """
  perPage: Int = 20
}

type Query {
  """
  Find an agent by ID (agents only)
  """
  agent(id: ID!): Agent

  """
  Get statistics for a specific agent
  """
  agentStats(
    """
    Agent ID (defaults to current agent)
    """
    agentId: ID
  ): AgentStats!

  """
  List all agents (agents only)
  """
  agents: [Agent!]!

  """
  Get statistics for all agents (admin only)
  """
  allAgentsStats: [AgentStats!]!

  """
  Get dashboard statistics (admin only)
  """
  dashboardStats: DashboardStats!

  """
  Currently authenticated user
  """
  me: CommentAuthorUnion

  """
  Find a ticket by ID
  """
  ticket(id: ID!): Ticket

  """
  Find a ticket by ticket number
  """
  ticketByNumber(ticketNumber: String!): Ticket

  """
  List tickets with pagination, filtering, and sorting
  """
  tickets(filter: TicketFilterInput, orderBy: TicketOrderByInput, pagination: PaginationInput = {}): TicketPage!
}

"""
Autogenerated return type of RefreshTokenMutation.
"""
type RefreshTokenMutationPayload {
  errors: [Error!]!
  success: Boolean
  user: CommentAuthorUnion
}

"""
Autogenerated return type of RequestPasswordReset.
"""
type RequestPasswordResetPayload {
  errors: [Error!]!
  success: Boolean!
}

"""
Autogenerated return type of ResetPassword.
"""
type ResetPasswordPayload {
  errors: [Error!]!
  success: Boolean!
}

"""
Autogenerated return type of SignIn.
"""
type SignInPayload {
  errors: [Error!]!
  user: CommentAuthorUnion
}

"""
Autogenerated return type of SignOut.
"""
type SignOutPayload {
  errors: [Error!]!
  success: Boolean!
}

"""
Autogenerated return type of SignUp.
"""
type SignUpPayload {
  customer: Customer
  errors: [Error!]!
}

"""
Sort direction
"""
enum SortDirectionEnum {
  ASC
  DESC
}

"""
A status change record from audit log
"""
type StatusChange {
  changedAt: ISO8601DateTime!
  changedBy: CommentAuthorUnion
  from: String
  to: String!
}

"""
Ticket count by status
"""
type StatusCount {
  count: Int!
  status: String!
}

"""
A support ticket
"""
type Ticket {
  assignedAgent: Agent

  """
  File attachments
  """
  attachments: [Attachment!]!

  """
  Available state transitions for this ticket
  """
  availableTransitions: [AvailableTransition!]!

  """
  Whether the current user can add a comment
  """
  canComment: Boolean!
  closedAt: ISO8601DateTime
  comments: [Comment!]!
  createdAt: ISO8601DateTime!
  customer: Customer!
  description: String!

  """
  Human-readable history events
  """
  history: [HistoryEvent!]!
  id: ID!
  status: String!
  statusHistory: [StatusChange!]!
  subject: String!
  ticketNumber: String!
  updatedAt: ISO8601DateTime!
}

"""
Filter parameters for tickets
"""
input TicketFilterInput {
  """
  Only show tickets assigned to current agent
  """
  assignedToMe: Boolean

  """
  Created after date
  """
  createdAfter: ISO8601DateTime

  """
  Created before date
  """
  createdBefore: ISO8601DateTime

  """
  Filter by customer ID
  """
  customerId: ID

  """
  Search in subject or ticket number
  """
  search: String

  """
  Filter by status
  """
  status: TicketStatusEnum
}

"""
Sorting parameters for tickets
"""
input TicketOrderByInput {
  """
  Sort direction
  """
  direction: SortDirectionEnum = DESC

  """
  Field to sort by
  """
  field: TicketSortFieldEnum!
}

"""
Paginated list of tickets
"""
type TicketPage {
  items: [Ticket!]!
  pageInfo: PageInfo!
}

"""
Fields to sort tickets by
"""
enum TicketSortFieldEnum {
  CREATED_AT
  STATUS
  SUBJECT
  UPDATED_AT
}

"""
Possible ticket statuses
"""
enum TicketStatusEnum {
  AGENT_ASSIGNED
  CLOSED
  HOLD
  IN_PROGRESS
  NEW
}

"""
Autogenerated return type of TransitionTicket.
"""
type TransitionTicketPayload {
  errors: [Error!]!
  ticket: Ticket
}
